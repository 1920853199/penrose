Colors {
  Colors.black = rgba(0.0, 0.0, 0.0, 1.0)
  Colors.lightBlue = rgba(0.1, 0.1, 0.9, 0.2)
  Colors.lightYellow = rgba(0.95, 0.96, 0.92, 0.5)
}


forall Box b {
    b.padding = 50.0
    b.text = Text {
        string : b.label
        -- w : ?
        -- h : ?
    }
    b.shape = Rectangle {
        strokeWidth : 0
        -- w : b.text.w + 50.0  does not work
        -- h : b.text.h + 50.0
        w : 124.0   -- REMOVE LATER
        h : 69.0    -- REMOVE LATER
    }

    ensure contains(b.shape, b.text, 5.0)
    encourage equal(b.shape.w - b.padding, b.text.w)
    encourage equal(b.shape.h - b.padding, b.text.h)
    -- encourage maximumSize(b.shape, b.text.w * b.text.h)
    encourage sameCenter(b.text, b.shape)
    LOCAL.layering = b.shape below b.text
}



Box x; Box y {
   -- Try to make sure no labels overlap
   -- LOCAL.genRepelFn = encourage repel(x.shape, y.shape, 2.0) THIS DOESN'T WORK
   ensure disjoint (x.shape, y.shape)
}

Arr a
where To(X, Y, a) 
with Box X; Box Y {
    a.padding = 5.0
    a.pt1 = Circle{
        r : 1.0
        -- x : ?
        -- y : ?
        strokeWidth: 0.0
        color: Colors.black
    }
    a.pt2 = Circle{
        r : 1.0
        -- x : ?
        -- y : ?
        strokeWidth: 0.0
        color: Colors.black
    }
    a.line1 = Line{
        startX : ?
        startY : ?
        endX : a.pt1.x
        endY : a.pt1.y
        thickness : 2.0
        color : Colors.black
    }
    a.line2 = Line{
        startX : a.pt1.x
        startY : a.pt1.y
        endX : a.pt2.x
        endY : a.pt2.y
        thickness : 2.0
        color : Colors.black
    }
    a.line3 = Line{
        startX : a.pt2.x
        startY : a.pt2.y
        endX : ?
        endY : ?
        thickness : 2.0
        color : Colors.black
    }
    a.text = Text {
      x: ?
      y : ?
      string : a.label
      rotation : 0.0
    }

    -- a.labelFnMargin = ensure atDist(a.shape, a.text, 20.0)

    a.labelFn  = encourage centerLabel(a.line1, a.text, 1.0)
    encourage totalMinLength(a.line1, a.line2, a.line3)
    -- ensure connect(X.shape, (a.line1.startX, a.line1.startY))
    -- ensure connect(Y.shape, (a.line3.endX, a.line3.endY))
    encourage cardinal(a.line1)
    encourage cardinal (a.line2)
    encourage cardinal (a.line3)
    encourage connectMid(X.shape, (a.line1.startX, a.line1.startY))
    encourage connectMid(Y.shape, (a.line3.endX, a.line3.endY))
    encourage sameLine(a.line1, a.line2)
    encourage sameLine(a.line2, a.line3)
}

Arr x; Arr y {
    encourage repel(x.text, y.shape)
}

Arr a; Box B {
    ensure disjoint(B.shape, a.text)
    ensure disjoint(B.shape, a.line1)
    ensure disjoint(a.pt1, B.shape)
    ensure disjoint(B.shape, a.line3)
    ensure disjoint(a.pt2, B.shape)
    ensure disjoint(B.shape, a.line2)
  }