plugin "graphLayout" (400.0, 400.0)

-- TODO: Maybe apply the SVG transforms at the end of the program here:
-- https://dagrejs.github.io/project/dagre-d3/latest/demo/sentence-tokenization.html

-- TODO: Style the different node types differently

const {
    const.padding = 10.0
    const.edgeStroke = 2.0
    const.nodeSize = 5.0
    const.nodeColor = Colors.lightblue
    const.arrowColor = Colors.black

    -- Convert from "dagre space" to Penrose canvas space
    -- TODO: deal with (invariant) font sizes
    const.scaleFactor = 0.3
    const.xShift = -200.0
    -- const.yShift = -200.0
    -- const.xShift = 0.0
    const.yShift = 0.0
    const.xFactor = 1.0
    const.yFactor = -1.0 -- Why is this flipped?
}

Colors {
    Colors.black = rgba(0.0, 0.0, 0.0, 1.0)
    Colors.darkgray = rgba(0.1, 0.1, 0.1, 1.0)
    Colors.gray = rgba(0.8, 0.8, 0.8, 1.0)
    Colors.red = rgba(1.0, 0.0, 0.0, 1.0)
    Colors.pink = rgba(1.0, 0.4, 0.7, 1.0)
    Colors.yellow = rgba(1.0, 1.0, 0.0, 1.0)
    Colors.orange = rgba(1.0, 0.6, 0.0, 1.0)
    Colors.lightorange = rgba(1.0, 0.6, 0.0, 0.25)
    Colors.green = rgba(0.0, 1.0, 0.0, 1.0)
    Colors.blue = rgba(0.0, 0.0, 1.0, 1.0)
    Colors.sky = rgba(0.325, 0.718, 0.769, 1.0)
    Colors.lightsky = rgba(0.325, 0.718, 0.769, 0.25)
    Colors.lightblue = rgba(0.0, 0.0, 1.0, 0.25)
    Colors.cyan = rgba(0.0, 1.0, 1.0, 1.0)
    Colors.purple = rgba(0.5, 0.0, 0.5, 1.0)
    Colors.white = rgba(1.0, 1.0, 1.0, 1.0)
    Colors.none = rgba(0.0, 0.0, 0.0, 0.0)
    Colors.bluegreen = rgba(0.44, 0.68, 0.60, 1.0)
}

Node n {
       n.shape = Circle { 
         x : const.xFactor * graphLayout[n.name]["x"] * const.scaleFactor + const.xShift
	 y : const.yFactor * graphLayout[n.name]["y"] * const.scaleFactor + const.yShift
         r : const.nodeSize
	 color : const.nodeColor
	 strokeWidth : 0.0
       }

       n.text = Text {
	 x : n.shape.x + const.padding
	 y : n.shape.y + const.padding
	 string : n.label
	 rotation : 0.0
	 color : n.shape.color -- Why is this color wrong?
       }
}

-- Ported from sty/tree.sty

Node x; Node y {
   -- Try to make sure no labels overlap
   LOCAL.genRepelFn = encourage repel(x.shape, y.shape, 5.0)
}

-- TODO: factor out redundant code w/ lists
Node p; Node c
where to(p, c) {
      LOCAL.shape = Arrow {
      		  startX : p.shape.x
      		  startY : p.shape.y
      		  endX : c.shape.x
      		  endY : c.shape.y
		  color : const.arrowColor
		  thickness : const.edgeStroke
      }

    -- Draw the arrow from y to x
    LOCAL.centerFn = encourage centerArrow(LOCAL.shape, p.shape, c.shape)

    -- Position y above x
    LOCAL.aboveFn = encourage above(p.shape, c.shape)

    -- Have sets 'fight' to be aligned with the superset's x-position
    LOCAL.equalFn = encourage equal(p.shape.x, c.shape.x)
}

-- Node p; Node c1; Node c2
-- where ParentOf2(p, c1, c2) {
--       LOCAL.shape1 = Arrow {
--       		  startX : p.shape.x
--       		  startY : p.shape.y
--       		  endX : c1.shape.x
--       		  endY : c1.shape.y
-- 		  color : const.arrowColor
-- 		  thickness : const.edgeStroke

--       }

--       LOCAL.shape2 = Arrow {
--       		  startX : p.shape.x
--       		  startY : p.shape.y
--       		  endX : c2.shape.x
--       		  endY : c2.shape.y
-- 		  color : const.arrowColor
-- 		  thickness : const.edgeStroke

--       }
-- }

-- Node p; Node c1; Node c2; Node c3
-- where ParentOf3(p, c1, c2, c3) {
--       LOCAL.shape1 = Arrow {
--       		  startX : p.shape.x
--       		  startY : p.shape.y
--       		  endX : c1.shape.x
--       		  endY : c1.shape.y
-- 		  color : const.arrowColor
-- 		  thickness : const.edgeStroke
--       }

--       LOCAL.shape2 = Arrow {
--       		  startX : p.shape.x
--       		  startY : p.shape.y
--       		  endX : c2.shape.x
--       		  endY : c2.shape.y
-- 		  color : const.arrowColor
-- 		  thickness : const.edgeStroke
--       }

--       LOCAL.shape3 = Arrow {
--       		  startX : p.shape.x
--       		  startY : p.shape.y
--       		  endX : c3.shape.x
--       		  endY : c3.shape.y
-- 		  color : const.arrowColor
-- 		  thickness : const.edgeStroke
--       }
-- }
